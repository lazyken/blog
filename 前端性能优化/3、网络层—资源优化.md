# HTTP 请求优化

在**开篇**中提到涉及网络层的有：

- DNS 解析
- TCP 连接
- HTTP 请求/响应

对于 DNS 解析和 TCP 连接两个步骤，前端可以做的努力相对有限，下面直接从 HTTP 开始：

**HTTP 优化有两个大的方向：**

## 1、减少请求次数

### 1.1 资源合并

#### 雪碧图

雪碧图是将多个小图标合并在一张图中，从而减少图片资源请求数量的一种优化方案。

### 1.2 图片 Base64

Base64 是一种用于传输 8Bit 字节码的编码方式，通过对图片进行 Base64 编码，我们可以直接将编码结果写入 HTML 或者写入 CSS，从而减少 HTTP 请求的次数。

## 2、减少单次请求所花费的时间

### 2.1 压缩代码：

Gzip 压缩，UglifyJsPlugin 压缩，Tree-Shaking

#### Tree-Shaking

tree shaking 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code)。它依赖于 ES2015 模块系统中的静态结构特性，例如 import 和 export。这个术语和概念实际上是兴起于 ES2015 模块打包工具 rollup。

新的 webpack 4 正式版本，扩展了这个检测能力，通过 package.json 的 "sideEffects" 属性作为标记，向 compiler 提供提示，表明项目中的哪些文件是 "pure(纯的 ES2015 模块)"，由此可以安全地删除文件中未使用的部分。

`tree shaking`，需要满足

#### webpack4 之前

- 使用 ES2015 模块语法（即 `import` 和 `export`）。
- 在项目 `package.json` 文件中，设置 `"sideEffects"`属性来提示 webpack 哪些文件是有副作用的。
- 引入一个能够删除未引用代码(dead code)的压缩工具(minifier)（例如 UglifyJSPlugin）。

#### webpack4

- 使用 ES2015 模块语法（即 `import` 和 `export`）。
- 在 `webpack.config.js` 中设置 `mode` 为 `production` ，它启用默认配置进行 `tree-shaking`，且能够消除副作用。
- webpack4 会根据选择的模式（mode）进行优化，但仍然可以配置 `Optimization` 属性来手动调整和覆盖默认配置。

### 2.2 抽离公共代码：CommonsChunkPlugin

webpack 的 CommonsChunkPlugin 插件：通过将公共模块拆出来，最终合成的文件能够在最开始的时候加载一次，以便存到缓存中供后续使用。这样后续新加载的页面也使用到公共模块时可以直接从缓存中读取，反之，新的文件本身也要包含所需要的公共模块的代码，体积变大。因此使用 CommonsChunkPlugin，对于新页面来说可以减小体积，请求时也就减少请求的时间了。
